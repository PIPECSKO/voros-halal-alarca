<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>The Red Death's Mask</title>
  <link rel="stylesheet" href="styles.css">
  <!-- Add PeerJS library -->
  <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
</head>
<body>
  <div id="game-container">
    <!-- Loading Screen -->
    <div id="loading-screen" class="screen" style="display: none;">
      <div class="loading-content">
        <h1 class="loading-title animated-title">V√∂r√∂s hal√°l √°larca</h1>
        <div class="loading-bar">
          <div class="loading-progress"></div>
        </div>
        <div class="loading-tip">K√©rlek, v√°rj am√≠g a b√°l el≈ëk√©sz√ºl...</div>
      </div>
    </div>
    
    <!-- Connecting Screen -->
    <div id="connecting-screen" class="screen" style="display: none;">
      <div class="connecting-content">
        <h1 class="connecting-title">Kapcsol√≥d√°s...</h1>
        <div class="connecting-spinner"></div>
        <div class="connecting-tip">K√©rlek, v√°rj am√≠g a kapcsolat l√©trej√∂n...</div>
      </div>
    </div>
    
    <!-- Menu Screen -->
    <div id="menu-screen" class="screen" style="display: flex;">
      <div class="menu-container modern-menu">
        <h1 class="menu-title">V√∂r√∂s hal√°l √°larca</h1>
        <div class="input-group">
          <input type="text" id="username-input" placeholder="Add meg a neved..." maxlength="16">
        </div>
        <div class="button-group">
          <button id="host-button" class="menu-button">J√°t√©k ind√≠t√°sa</button>
          <button id="join-button" class="menu-button">Csatlakoz√°s</button>
          <button id="fullscreen-button" class="menu-button">üñ•Ô∏è Teljes k√©perny≈ë</button>
        </div>
        <div class="input-group" id="join-code-group" style="display:none;">
          <label for="game-code-input" style="color: #8b0000; margin-bottom: 5px; display: block;">Add meg a szobak√≥dot:</label>
          <div style="display: flex; gap: 10px; align-items: center;">
            <input type="text" id="game-code-input" placeholder="Szobak√≥d..." maxlength="40" style="flex: 1;">
            <button id="join-now-button" class="menu-button" style="margin: 0;">Csatlakoz√°s most</button>
          </div>
        </div>
        <div class="game-code-container" style="display: none;">
          <p>Szobak√≥d: <span id="game-code"></span></p>
        </div>
        
        <!-- Volume Controls -->
        <div class="volume-controls-main-menu" style="
          margin-top: 30px;
          padding-top: 20px;
          border-top: 2px solid #8b0000;
          text-align: center;
        ">
          <h3 style="color: #8b0000; margin-bottom: 15px; font-family: 'MedievalSharp', serif;">Hanger≈ë be√°ll√≠t√°sok</h3>
          <div style="display: flex; flex-direction: column; align-items: center; gap: 15px;">
            <div style="display: flex; flex-direction: column; align-items: center; gap: 8px;">
              <label style="color: #8b0000; font-size: 14px; font-family: 'MedievalSharp', serif;">Zene hanger≈ë</label>
              <input type="range" id="main-menu-music-volume-slider" min="0" max="100" value="40" style="
                width: 200px;
                accent-color: #8b0000;
              ">
              <span id="main-menu-music-volume-display" style="color: #8b0000; font-size: 12px; font-family: 'MedievalSharp', serif;">40%</span>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Lobby Screen -->
    <div id="lobby-screen" class="screen" style="display: none;">
      <div class="lobby-container">
        <h2>V√°r√≥terem</h2>
        <div class="lobby-flex">
          <div class="player-list">
            <h3>J√°t√©kosok</h3>
            <ul id="player-list"></ul>
          </div>
          <div class="character-select-panel">
            <h3>Karakterv√°laszt√°s</h3>
            <div class="character-gender-group">
              <button id="gender-male" class="menu-button">F√©rfi</button>
              <button id="gender-female" class="menu-button">N≈ë</button>
            </div>
            <div id="character-gallery" class="character-gallery"></div>
            <div class="character-preview-label">El≈ën√©zet</div>
            <div id="character-preview" class="character-preview"></div>
            <button id="start-button" class="menu-button">J√°t√©k ind√≠t√°sa</button>
            <!-- DEV ROLE SELECT DROPDOWN -->
            <div id="dev-role-select-container" style="margin-top: 10px; display: none;">
              <label for="dev-role-select">Szerep (dev):</label>
              <select id="dev-role-select">
                <option value="commoner">Polg√°r</option>
                <option value="noble">Nemes</option>
                <option value="prince">Herceg</option>
                <option value="plague">Pestis</option>
              </select>
            </div>
            <div id="color-select-container" style="margin-top: 10px;">
              <label for="color-select">Sz√≠n:</label>
              <select id="color-select">
                <option value="red">Piros</option>
                <option value="blue">K√©k</option>
                <option value="green">Z√∂ld</option>
                <option value="yellow">S√°rga</option>
                <option value="purple">Lila</option>
                <option value="orange">Narancs</option>
              </select>
            </div>
          </div>
        </div>
        <div class="button-group">
          <button id="ready-button">K√©sz vagyok</button>
          <button id="start-button" style="display: none;">J√°t√©k ind√≠t√°sa</button>
        </div>
        
        <!-- Volume Controls in Lobby -->
        <div class="volume-controls-lobby" style="
          margin-top: auto;
          padding: 8px;
          border-top: 2px solid #8b0000;
          text-align: center;
          width: 100%;
          background: rgba(26, 0, 0, 0.95);
          border: 2px solid #8b0000;
          border-radius: 8px;
          flex-shrink: 0;
        ">
          <h3 style="color: #8b0000; margin-bottom: 10px; font-family: 'MedievalSharp', serif; font-size: 16px;">Hanger≈ë be√°ll√≠t√°sok</h3>
          <div style="display: flex; justify-content: space-around; align-items: center; gap: 30px;">
            <div style="display: flex; flex-direction: column; align-items: center; gap: 8px;">
              <label style="color: #8b0000; font-size: 14px; font-family: 'MedievalSharp', serif;">Zene hanger≈ë</label>
              <input type="range" id="lobby-music-volume-slider" min="0" max="100" value="40" style="
                width: 150px;
                accent-color: #8b0000;
              ">
              <span id="lobby-music-volume-display" style="color: #8b0000; font-size: 12px; font-family: 'MedievalSharp', serif;">40%</span>
            </div>
            <div style="display: flex; flex-direction: column; align-items: center; gap: 8px;">
              <label style="color: #8b0000; font-size: 14px; font-family: 'MedievalSharp', serif;">Hangeffektek</label>
              <input type="range" id="lobby-sfx-volume-slider" min="0" max="100" value="60" style="
                width: 150px;
                accent-color: #8b0000;
              ">
              <span id="lobby-sfx-volume-display" style="color: #8b0000; font-size: 12px; font-family: 'MedievalSharp', serif;">60%</span>
            </div>
          </div>
        </div>
        <div id="lobby-game-code" style="text-align:center; font-size:1.5rem; color:#FFD700; margin-bottom:1rem; letter-spacing: 3px;">
          Szoba k√≥d: <span id="lobby-game-code-value"></span>
        </div>
      </div>
    </div>
    
    <!-- Game Screen -->
    <div id="game-screen" class="screen" style="display: none;">
      <canvas id="game-canvas"></canvas>
      <div class="game-ui">
        <div class="role-display"></div>
        <div class="timer-display"></div>
        <div class="mini-map"></div>
        <div class="task-list-container">
          <ul id="task-list"></ul>
        </div>
        
        <!-- Fullscreen Indicator -->
        <div id="fullscreen-indicator" style="position: absolute; top: 10px; right: 10px; background: rgba(26, 0, 0, 0.8); color: #8b0000; padding: 5px 10px; border: 1px solid #8b0000; font-size: 12px; display: none;">
          üì∫ Teljes k√©perny≈ë - ESC a kil√©p√©shez
        </div>
        
        <!-- Action Buttons -->
        <div class="action-buttons">
          <button id="infect-button" class="action-button" style="display: none;">
            <span class="action-icon">ü¶†</span>
            <span class="action-text">Fert≈ëz</span>
          </button>
          <button id="slash-button" class="action-button" style="display: none;">
            <span class="action-icon">üó°Ô∏è</span>
            <span class="action-text">Suhint√°s</span>
          </button>
          <button id="task-button" class="action-button" style="display: none;">
            <span class="action-icon">üìú</span>
            <span class="action-text">Feladat</span>
          </button>
          <button id="clean-body-button" class="action-button" style="display: none;">
            <span class="action-icon">üßπ</span>
            <span class="action-text">Takar√≠t√°s</span>
          </button>
        </div>
      </div>
    </div>
    
    <!-- Discussion Screen -->
    <div id="discussion-screen" class="screen" style="display: none;">
      <div class="discussion-content">
        <h1>Megbesz√©l√©s</h1>
        <div id="discussion-timer">00:00</div>
        <div class="discussion-table">
          <table id="discussion-table">
            <!-- Table content will be populated dynamically -->
          </table>
        </div>
      </div>
    </div>
    
    <!-- Game Over Screen -->
    <div id="game-over-screen" class="screen" style="display: none;">
      <div class="game-over-content">
        <h1>J√°t√©k v√©ge</h1>
        <div id="winner-message"></div>
        <div class="role-reveals">
          <!-- Role reveals will be populated dynamically -->
        </div>
        <button id="return-to-menu-button">Vissza a men√ºbe</button>
      </div>
    </div>
    
    <!-- Error Message Overlay -->
    <div id="error-message" class="overlay">
      <div class="error-content">
        <h2>Hiba</h2>
        <p id="error-text"></p>
        <button id="error-ok-button">OK</button>
      </div>
    </div>
    
    <!-- Debug Controls (Hidden by default) -->
    <div id="debug-controls" style="position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.7); padding: 10px; border-radius: 5px; z-index: 1000; display: none;">
      <h3 style="color: red; margin: 0 0 5px 0;">Debug</h3>
      <div>
        <label for="debug-role">Role:</label>
        <select id="debug-role">
          <option value="prince">Prince</option>
          <option value="noble">Noble</option>
          <option value="commoner">Commoner</option>
          <option value="plague">Plague</option>
        </select>
      </div>
      <div>
        <input type="checkbox" id="debug-show-shapes">
        <label for="debug-show-shapes">Show shapes</label>
      </div>
      <div style="margin-top: 10px;">
        <a href="/connection-test" target="_blank" style="color: #00ff00; text-decoration: underline;">Open Connection Test</a>
      </div>
    </div>
  </div>

  <!-- Connection Status Indicator -->
  <div id="connection-status" class="status-connecting">
    <div id="connection-indicator"></div>
    <span id="connection-text">Kapcsol√≥d√°s...</span>
  </div>

  <!-- Game Scripts -->
  <script type="module">
    // Show the loading screen immediately
    document.getElementById('loading-screen').style.display = 'flex';
    
    // Manually show a progress animation
    const progress = document.querySelector('.loading-progress');
    let width = 0;
    const interval = setInterval(() => {
      if (width >= 100) {
        clearInterval(interval);
        // Skip directly to the menu screen after loading completes
        document.getElementById('loading-screen').style.display = 'none';
        document.getElementById('menu-screen').style.display = 'flex';
      } else {
        width += 2;
        progress.style.width = width + '%';
      }
    }, 50);
    
    // Enable debug mode
    window.debugMode = true;
  </script>
  
  <script type="module" src="src/main.js?v=20251610220000"></script>
</body>
</html> 